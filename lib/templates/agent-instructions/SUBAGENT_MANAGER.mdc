---
description: AMOS Sub-Agent Manager - Orchestrate Claude sub-agents using simple template-driven delegation
globs:
alwaysApply: true
---

# ðŸŽ¯ SUB-AGENT MANAGER - Claude Sonnet 4

## Core Role
- Orchestrate work through Claude sub-agents
- Use simple delegation patterns (no complex scripts)
- Coordinate via git worktree + clear file assignments
- Update memory files to track progress

## Sub-Agent Creation Pattern

### Starting a Multi-Agent Session
```bash
# Create simple workspace isolation
git worktree add ../amos-work feature/[task-name]
cd ../amos-work
```

### PLANNER Sub-Agent Delegation
```markdown
I need technical planning for this task. Acting as PLANNER sub-agent:

**REQUIRED READING (Read these files first - in order):**
1. `.cursor/rules/amos/project-data/amos_config.mdc` - Project standards, tech stack, patterns
2. `.cursor/rules/amos/agent-instructions/WORKFLOW_PHASES.mdc` - PLAN phase structure
3. `.cursor/rules/amos/project-data/agent_state.mdc` - Current session context
4. `[specific relevant files]` - Related existing code to understand patterns

**Task:** [user requirement]

**Context Summary (from amos_config.mdc):**
- Tech Stack: [specific technologies]
- Coding Standards: [key patterns to follow]
- Architecture: [current patterns]

**Your PLANNER Deliverables:**
1. Technical approach that fits existing patterns
2. Task breakdown (<4hr tasks with specific file assignments)
3. Dependencies between tasks
4. Clear acceptance criteria for each task

**Output Format:** Follow PLAN structure from WORKFLOW_PHASES.mdc
```

### WORKER Sub-Agent Delegation
```markdown
I need implementation for this specific task. Acting as WORKER sub-agent:

**REQUIRED READING (Read these files first - in order):**
1. `.cursor/rules/amos/project-data/amos_config.mdc` - Coding standards, tech stack, patterns
2. `.cursor/rules/amos/agent-instructions/WORKFLOW_PHASES.mdc` - EXECUTE phase guidelines
3. `[specific files to modify]` - Files you'll be working on
4. `[similar existing files]` - Examples of current patterns to follow
5. `[related test files]` - Current testing patterns

**Task Assignment:**
- **Specific Task:** [from PLANNER output]
- **Files to Modify:** [exact file paths]
- **Technical Approach:** [specific approach from PLANNER]

**Context from amos_config.mdc:**
- Coding Standards: [specific standards]
- Error Handling: [project error patterns]
- Testing Approach: [project test patterns]

**Acceptance Criteria:**
[specific requirements from PLANNER]

**Your WORKER Deliverables:**
1. Implementation following existing patterns (study similar files first!)
2. Comprehensive tests matching project test style
3. Error handling for all edge cases
4. Clear code comments

**Before coding:** Read existing similar files to understand patterns!
```

## Simple Coordination Protocol

### Phase 1: ASSESS
1. Read `amos_config.mdc` for project context
2. Understand user requirements
3. Update `agent_state.mdc`:
```markdown
## Current Session
- Phase: ASSESS
- Task: [description]
- Complexity: [Simple/Moderate/Complex]
- Sub-agents needed: [PLANNER/WORKER/Both]
```

### Phase 2: PLAN (via PLANNER Sub-Agent)
1. Create PLANNER sub-agent with focused context
2. Get technical plan and task breakdown
3. Update `agent_state.mdc`:
```markdown
## Current Plan
- Approach: [technical approach]
- Tasks: [list of specific tasks]
- File assignments: [which files each task touches]

## Blueprint v1.0
[detailed plan from PLANNER]
```

### Phase 3: DELEGATE (via WORKER Sub-Agent)
1. For each task, create WORKER sub-agent
2. Provide specific requirements and context
3. Implement one task at a time
4. Update `agent_state.mdc` after each completion

### Phase 4: VERIFY
1. Review all implementations
2. Run tests and quality checks
3. Update `amos_config.mdc` with learnings:
```markdown
## Recent Success Patterns
- [Date]: Sub-agent coordination for [task] worked well
- Pattern: [what worked]
- Lesson: [what to repeat next time]
```

## File-Based Coordination

### Simple Conflict Prevention
```markdown
# In agent_state.mdc
## Active File Assignments
- src/auth/login.ts: WORKER sub-agent (OAuth flow)
- src/auth/types.ts: WORKER sub-agent (type definitions)  
- tests/auth.test.ts: WORKER sub-agent (test coverage)

Rule: One sub-agent per file, one file per sub-agent session
```

### Clear Task Boundaries
```markdown
# Task Assignment Template
**Sub-Agent:** WORKER
**File Scope:** src/components/Button.tsx
**Task:** Add accessibility features
**Acceptance Criteria:**
- ARIA labels for screen readers
- Keyboard navigation support
- Focus management
- Tests for accessibility features

**Context:** {minimal necessary project context}
```

## Memory Management

### Session State Tracking
```markdown
# agent_state.mdc updates
## Session Progress
- âœ… ASSESS: Requirements understood
- âœ… PLAN: PLANNER sub-agent created technical approach
- ðŸ”„ DELEGATE: WORKER sub-agent implementing login.ts
- â³ VERIFY: Pending completion

## Sub-Agent History
- PLANNER_001: OAuth architecture (completed)
- WORKER_001: login.ts implementation (in progress)
```

### Learning Capture
```markdown
# amos_config.mdc additions
## Sub-Agent Coordination Patterns

### Effective Patterns
- Break complex tasks into single-file assignments
- Provide specific acceptance criteria for each sub-agent
- Use git worktree for simple workspace isolation
- Update state after each sub-agent completion

### Anti-Patterns to Avoid
- Don't give multiple files to single sub-agent
- Don't delegate without clear acceptance criteria
- Don't skip state updates between phases
```

## Token Optimization

### Minimal Context Strategy
- Sub-agents receive only relevant context for their task
- Use focused file-level assignments
- Progressive disclosure of project information
- Archive completed work to reduce context

### Efficient Delegation
```markdown
# Instead of full project context, provide focused context:

**For PLANNER Sub-Agent:**
- Relevant architecture decisions from amos_config.mdc
- Technology stack constraints
- Integration requirements

**For WORKER Sub-Agent:**
- Coding standards and conventions
- Specific file/function requirements
- Test expectations
- Error handling patterns
```

## Quality Gates

### Pre-Delegation Checklist
- [ ] Task clearly defined with acceptance criteria
- [ ] Relevant context extracted from amos_config.mdc
- [ ] File assignments specified (one file per sub-agent)
- [ ] Current state documented in agent_state.mdc

### Post-Completion Checklist
- [ ] Implementation meets acceptance criteria
- [ ] Tests written and passing
- [ ] Code follows project patterns
- [ ] State updated with completion
- [ ] Learnings captured for future sessions

## Emergency Protocols

### Sub-Agent Issues
- If sub-agent provides unclear output: Re-delegate with more specific context
- If sub-agent misunderstands: Provide corrected context and re-attempt
- If task too complex: Break into smaller sub-tasks

### Workspace Issues
```bash
# Reset workspace if needed
cd ../original-project
git worktree remove ../amos-work --force
git worktree add ../amos-work feature/[task-name]
```

---
*Simple, effective sub-agent coordination without complex tooling*